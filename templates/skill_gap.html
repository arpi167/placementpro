{% extends 'base.html' %}
{% block title %}Skill Gap AI â€“ PlacementPro{% endblock %}
{% block extra_style %}
<style>
.role-pill { padding:0.45rem 1.1rem; border-radius:20px; font-size:0.83rem; font-weight:700; cursor:pointer; border:2px solid var(--border); background:white; color:var(--muted); transition:all 0.15s; text-decoration:none; display:inline-flex; align-items:center; gap:0.3rem; }
.role-pill.active { background:var(--blue); color:white; border-color:var(--blue); }
.role-pill:hover:not(.active) { border-color:var(--blue); color:var(--blue); text-decoration:none; }
.skill-chip { display:flex; align-items:center; gap:0.6rem; padding:0.55rem 0.9rem; border-radius:10px; font-size:0.87rem; }
.skill-have { background:#f0fdf4; border:1px solid #86efac; }
.skill-missing { background:#fef2f2; border:1px solid #fca5a5; }
.roadmap-card { border:1px solid var(--border); border-radius:14px; overflow:hidden; transition:box-shadow 0.2s; background:white; }
.roadmap-card:hover { box-shadow:var(--shadow-md); }
.priority-badge { font-size:0.68rem; font-weight:800; padding:0.18rem 0.6rem; border-radius:20px; letter-spacing:0.04em; }
.difficulty-tag { font-size:0.72rem; padding:0.2rem 0.6rem; border-radius:6px; font-weight:600; }
.insight-box { background:linear-gradient(135deg,#eff6ff,#f5f3ff); border:1px solid #c7d2fe; border-radius:12px; padding:1rem 1.25rem; }
.step-circle { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:0.8rem; flex-shrink:0; }
</style>
{% endblock %}
{% block content %}
<div class="page-header">
  <a href="/student" style="color:var(--muted);font-size:0.85rem;">â† Dashboard</a>
  <h1>ğŸ§  Skill Gap AI</h1>
  <p>AI-powered career readiness analysis with personalised learning roadmap.</p>
</div>

<!-- ROLE SELECTOR -->
<div class="card" style="margin-bottom:1.5rem;">
  <div style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);margin-bottom:0.75rem;">Select Target Role</div>
  <div style="display:flex;flex-wrap:wrap;gap:0.5rem;">
    {% for r in roles %}
    <a href="/student/skill-gap?role={{ r|urlencode }}" class="role-pill {% if r == target_role %}active{% endif %}">
      {% if r == 'Data Analyst' %}ğŸ“Š
      {% elif r == 'Software Engineer' %}ğŸ’»
      {% elif r == 'Full Stack Developer' %}ğŸŒ
      {% elif r == 'DevOps Engineer' %}âš™ï¸
      {% elif r == 'ML Engineer' %}ğŸ¤–{% endif %}
      {{ r }}
    </a>
    {% endfor %}
  </div>
</div>

<!-- â•â• SECTION 1: SKILL GAP SUMMARY â•â• -->
<div style="display:grid; grid-template-columns:240px 1fr; gap:1.5rem; margin-bottom:1.5rem; align-items:start;">

  <!-- CAREER READINESS SCORE -->
  <div class="card" style="text-align:center; border-top:4px solid {% if gap.match_pct >= 70 %}var(--green){% elif gap.match_pct >= 40 %}var(--amber){% else %}var(--red){% endif %};">
    <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);margin-bottom:0.75rem;">Career Readiness</div>
    <!-- Circular Progress -->
    <div style="position:relative;width:130px;height:130px;margin:0 auto 0.75rem;">
      <svg width="130" height="130" viewBox="0 0 130 130" style="transform:rotate(-90deg)">
        <circle cx="65" cy="65" r="52" fill="none" stroke="#e2e8f0" stroke-width="11"/>
        <circle cx="65" cy="65" r="52" fill="none"
          stroke="{% if gap.match_pct >= 70 %}#16a34a{% elif gap.match_pct >= 40 %}#d97706{% else %}#dc2626{% endif %}"
          stroke-width="11" stroke-linecap="round"
          stroke-dasharray="326.7"
          stroke-dashoffset="{{ 326.7 - (gap.match_pct / 100 * 326.7) }}"
          style="transition:stroke-dashoffset 1s ease;"/>
      </svg>
      <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
        <div style="font-family:'Syne',sans-serif;font-size:2.2rem;font-weight:800;line-height:1;color:{% if gap.match_pct >= 70 %}var(--green){% elif gap.match_pct >= 40 %}var(--amber){% else %}var(--red){% endif %};">{{ gap.match_pct }}%</div>
        <div style="font-size:0.65rem;color:var(--muted);font-weight:600;">SCORE</div>
      </div>
    </div>
    <div style="font-size:0.9rem;font-weight:800;color:{% if gap.match_pct >= 70 %}var(--green){% elif gap.match_pct >= 40 %}var(--amber){% else %}var(--red){% endif %};">
      {% if gap.match_pct >= 80 %}ğŸ‰ Job Ready!
      {% elif gap.match_pct >= 60 %}ğŸ“ˆ Nearly There
      {% elif gap.match_pct >= 40 %}ğŸ”§ Developing
      {% else %}ğŸŒ± Foundation Stage{% endif %}
    </div>
    <div style="font-size:0.75rem;color:var(--muted);margin-top:0.25rem;">for {{ target_role }}</div>
    <!-- Mini counters -->
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.5rem;margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);">
      <div><div style="font-weight:800;font-size:1.3rem;color:var(--green);">{{ gap.have|length }}</div><div style="font-size:0.65rem;color:var(--muted);font-weight:600;">ACQUIRED</div></div>
      <div><div style="font-weight:800;font-size:1.3rem;color:var(--red);">{{ gap.missing|length }}</div><div style="font-size:0.65rem;color:var(--muted);font-weight:600;">MISSING</div></div>
      <div><div style="font-weight:800;font-size:1.3rem;color:var(--blue);">{{ gap.required|length }}</div><div style="font-size:0.65rem;color:var(--muted);font-weight:600;">REQUIRED</div></div>
    </div>
  </div>

  <!-- RIGHT COLUMN: CHECKLIST + AI INSIGHT -->
  <div style="display:flex;flex-direction:column;gap:1rem;">
    <!-- SKILLS CHECKLIST -->
    <div class="card">
      <div class="card-title">ğŸ“‹ Skills Checklist for {{ target_role }}</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.4rem;">
        {% for skill in gap.required %}
        {% set have = skill in gap.have %}
        <div class="skill-chip {% if have %}skill-have{% else %}skill-missing{% endif %}">
          <span>{% if have %}âœ…{% else %}âŒ{% endif %}</span>
          <span style="font-weight:{% if have %}700{% else %}500{% endif %};color:{% if have %}var(--green){% else %}var(--text){% endif %};">{{ skill }}</span>
          <span class="badge {% if have %}badge-green{% else %}badge-red{% endif %}" style="margin-left:auto;font-size:0.65rem;">{% if have %}Have{% else %}Gap{% endif %}</span>
        </div>
        {% endfor %}
      </div>
    </div>
    <!-- AI INSIGHT -->
    <div class="insight-box">
      <div style="font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:#4338ca;margin-bottom:0.5rem;">ğŸ¤– AI Insight</div>
      <p style="font-size:0.88rem;color:#312e81;line-height:1.6;margin:0;">
        {% if gap.match_pct >= 80 %}
        You have <strong>all essential skills</strong> for {{ target_role }}. Focus on deepening expertise in {{ gap.have[0] if gap.have else 'your current skills' }} and building a strong project portfolio to stand out in interviews.
        {% elif gap.match_pct >= 50 %}
        You have a <strong>solid foundation</strong> with {{ gap.have|length }} of {{ gap.required|length }} required skills. Prioritise learning <strong>{{ gap.missing[0].skill if gap.missing else '' }}</strong> first as it appears in 80%+ of {{ target_role }} job postings.
        {% else %}
        You are at the <strong>early stage</strong> for {{ target_role }}. Start with the High Priority skills below â€” they form the core of this role. Completing just the top 2 skills will boost your readiness score by ~40%.
        {% endif %}
      </p>
    </div>
  </div>
</div>

<!-- â•â• SECTION 2: AI LEARNING ACTION PLAN â•â• -->
{% if gap.missing %}
<div class="card" style="margin-bottom:1.5rem; border-top:3px solid var(--blue);">
  <div class="card-title">ğŸ—ºï¸ AI Learning Action Plan</div>
  <p style="font-size:0.85rem;color:var(--muted);margin-bottom:1.25rem;">Ranked by importance for <strong>{{ target_role }}</strong>. Complete in order for fastest results.</p>

  <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:1rem;">
    {% for item in gap.missing %}
    {% set idx = loop.index %}
    {% set is_high = idx <= 2 %}
    {% set is_med = idx > 2 and idx <= 4 %}
    <div class="roadmap-card">
      <!-- Card Header -->
      <div style="padding:0.75rem 1rem; background:{% if is_high %}#fef2f2{% elif is_med %}#fffbeb{% else %}#f8fafc{% endif %}; display:flex; align-items:center; gap:0.75rem; border-bottom:1px solid var(--border);">
        <div style="width:32px;height:32px;border-radius:50%;background:{% if is_high %}#dc2626{% elif is_med %}#d97706{% else %}#64748b{% endif %};color:white;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.85rem;flex-shrink:0;">{{ idx }}</div>
        <div style="flex:1;">
          <div style="font-weight:700;font-size:0.95rem;">{{ item.skill }}</div>
          <div style="display:flex;gap:0.4rem;margin-top:0.2rem;flex-wrap:wrap;">
            <span class="priority-badge" style="background:{% if is_high %}#fee2e2;color:#dc2626{% elif is_med %}#fef3c7;color:#d97706{% else %}#f1f5f9;color:#64748b{% endif %};">
              {% if is_high %}ğŸ”¥ HIGH{% elif is_med %}âš¡ MEDIUM{% else %}ğŸ“˜ LOW{% endif %}
            </span>
            <span class="difficulty-tag" style="background:{% if idx == 1 %}#fef2f2;color:#dc2626{% elif idx <= 3 %}#fffbeb;color:#d97706{% else %}#f0fdf4;color:#16a34a{% endif %};">
              {% if idx == 1 %}Hard{% elif idx <= 3 %}Medium{% else %}Easy{% endif %}
            </span>
          </div>
        </div>
      </div>
      <!-- Card Body -->
      <div style="padding:0.9rem 1rem;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem;">
          <div style="font-size:0.82rem;color:var(--muted);">
            <span>ğŸ“š {{ item.platform }}</span>
          </div>
          <span class="badge badge-gray">~{{ item.hours }}h</span>
        </div>
        <!-- Progress bar showing time relative to total -->
        <div style="background:var(--bg);border-radius:20px;height:6px;margin-bottom:0.75rem;overflow:hidden;">
          <div style="height:100%;border-radius:20px;width:{% if item.hours <= 10 %}30{% elif item.hours <= 20 %}55{% elif item.hours <= 30 %}75{% else %}90{% endif %}%;background:{% if is_high %}var(--red){% elif is_med %}var(--amber){% else %}var(--blue){% endif %};"></div>
        </div>
        <a href="{{ item.url }}" target="_blank" class="btn btn-primary btn-sm" style="width:100%;text-align:center;justify-content:center;">Start Learning â†’</a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- STEP-BY-STEP ROADMAP -->
<div class="card" style="margin-bottom:1.5rem;">
  <div class="card-title">ğŸ“‹ Step-by-Step Action Plan</div>
  <div style="position:relative;">
    <!-- Vertical line -->
    <div style="position:absolute;left:14px;top:0;bottom:0;width:2px;background:var(--border);z-index:0;"></div>
    <!-- Completed steps -->
    {% for item in gap.have %}
    <div style="display:flex;gap:1rem;align-items:start;padding:0.65rem 0;position:relative;">
      <div class="step-circle" style="background:var(--green);color:white;z-index:1;">âœ“</div>
      <div style="padding-top:0.15rem;">
        <div style="font-weight:700;color:var(--green);">{{ item }}</div>
        <div style="font-size:0.78rem;color:var(--muted);">Already acquired â€” keep practising!</div>
      </div>
    </div>
    {% endfor %}
    <!-- Missing steps -->
    {% for item in gap.missing %}
    <div style="display:flex;gap:1rem;align-items:start;padding:0.65rem 0;position:relative;">
      <div class="step-circle" style="background:var(--blue);color:white;z-index:1;">{{ loop.index }}</div>
      <div style="flex:1;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div style="font-weight:700;">Learn {{ item.skill }}</div>
          <span class="badge badge-gray">~{{ item.hours }}h</span>
        </div>
        <div style="font-size:0.8rem;color:var(--muted);">via {{ item.platform }} â€” <a href="{{ item.url }}" target="_blank" style="color:var(--blue);">open course â†’</a></div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% else %}
<div class="card" style="text-align:center;padding:3rem;background:var(--green-light);border-color:#86efac;">
  <div style="font-size:4rem;margin-bottom:1rem;">ğŸ‰</div>
  <h3 style="font-family:'Syne',sans-serif;color:var(--green);font-weight:800;font-size:1.5rem;">You're Job Ready!</h3>
  <p style="color:var(--green);margin-top:0.5rem;">You have <strong>all required skills</strong> for <strong>{{ target_role }}</strong>. Apply with confidence!</p>
  <a href="/student" class="btn btn-success" style="margin-top:1.25rem;">Browse Eligible Drives â†’</a>
</div>
{% endif %}

{% if gap.have %}
<div class="card" style="background:var(--green-light);border-color:#86efac;">
  <div style="font-size:0.75rem;font-weight:700;text-transform:uppercase;color:var(--green);margin-bottom:0.75rem;">âœ… Skills Already Acquired</div>
  <div style="display:flex;flex-wrap:wrap;gap:0.4rem;">
    {% for s in gap.have %}<span class="badge badge-green" style="font-size:0.8rem;padding:0.3rem 0.8rem;">{{ s }}</span>{% endfor %}
  </div>
</div>
{% endif %}
{% endblock %}
